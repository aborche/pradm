#!/usr/bin/perl

use strict;
use warnings;
use Text::CSV;
use vars qw /%hosts %ips/;

my $csv = Text::CSV->new();

while(<>) {
  s/[^0-9A-Za-z\.\-\_\:\,\"\'\/\%]//g;
  next if /^$/;
  if ($csv->parse($_)) {
    my @columns = $csv->fields();
    $hosts{cut_shit($columns[1])} = 1 if($columns[1] ne '-');
    $ips{cut_shit($columns[2])} = 1;
  } else {
    my $err = $csv->error_input;
#    print "Failed to parse line: $err";
  }
}
open WHITE,"</usr/local/squid/catdbserver/whitelist.txt";
while(<WHITE>)
{
  chomp();
  if(defined($hosts{$_})) { delete $hosts{$_}; }
}
close WHITE;

print join "\n",keys %hosts;
print join "\n",keys %ips;



sub cut_shit
{
  my $str = shift;
  my($data,undef) = split ('/',$str);
  $data =~ s/(\:.*)$//g;
  return $data;
}